<div class="listen-container">
  <h2>ğŸ¤ Speech Recognition Studio</h2>

  <!-- Language Selection -->
  <div class="language-selection">
    <h3>ğŸŒ Language Selection:</h3>
    <div class="radio-group">
      <label class="radio-option">
        <input type="radio" name="language" value="multi" [(ngModel)]="selectedLanguage">
        <span>ğŸ³ï¸ Multilingual (EN + IT)</span>
      </label>
      <label class="radio-option">
        <input type="radio" name="language" value="en" [(ngModel)]="selectedLanguage">
        <span>ğŸ‡ºğŸ‡¸ English</span>
      </label>
      <label class="radio-option">
        <input type="radio" name="language" value="it" [(ngModel)]="selectedLanguage">
        <span>ğŸ‡®ğŸ‡¹ Italian</span>
      </label>
    </div>
  </div>

  <!-- Recording Controls -->
  <div class="recording-section">
    <h3>ğŸ™ï¸ Audio Recording</h3>

    <div class="control-buttons">
      <button (click)="startRecording()" [disabled]="isRecording || isStartingRecording" class="record-btn">
        <span *ngIf="!isRecording && !isStartingRecording">â–¶ï¸ Start</span>
        <span *ngIf="isStartingRecording">â³ Starting...</span>
        <span *ngIf="isRecording">âºï¸ Recording...</span>
      </button>
      <button (click)="stopRecording()" [disabled]="!isRecording" class="stop-btn">
        â¹ï¸ Stop
      </button>
      <button (click)="resetRecording()" class="reset-btn">
        ğŸ”„ Reset
      </button>
    </div>

    <div class="audio-display">
      <div *ngIf="audioBlob" class="audio-info">
        <strong>Audio Ready</strong> ({{ audioDuration || '0' }} seconds, {{ audioSize || '0' }} MB)
      </div>
      <div *ngIf="!audioBlob" class="audio-info">
        No audio recorded
      </div>
    </div>
  </div>

  <!-- Audio Playback -->
  <div *ngIf="audioBlob" class="audio-playback-section">
    <h3>ğŸ”Š Listen to Recorded Audio</h3>
    <div class="audio-player">
      <audio controls [src]="audioUrl" class="audio-element">
        Your browser does not support the audio element.
      </audio>
      <p class="audio-note">ğŸµ Play your recorded audio before transcribing</p>
    </div>
  </div>

  <!-- Transcription Results -->
  <div class="transcription-section">
    <h3>ğŸ“ Transcription Result:</h3>
    <div class="transcription-controls">
      <button (click)="transcribeAudio()" [disabled]="!audioBlob || isTranscribing" class="transcribe-btn">
        <span *ngIf="!isTranscribing">ğŸ¯ Transcribe</span>
        <span *ngIf="isTranscribing">â³ Transcribing...</span>
      </button>
    </div>

    <div class="transcript-input">
      <textarea [(ngModel)]="transcript" placeholder="Transcription result will appear here..." readonly></textarea>
    </div>
  </div>

  <!-- Training Data Upload -->
  <div class="training-section">
    <h3>ğŸš€ Speech Recognition Training</h3>
    <p>Upload your recorded audio for LoRA fine-tuning the Whisper model.</p>

    <div class="training-controls">
      <button (click)="uploadForTraining()" [disabled]="!audioBlob || isUploading" class="upload-btn">
        <span *ngIf="!isUploading">â¬†ï¸ Upload for Training</span>
        <span *ngIf="isUploading">â³ Uploading...</span>
      </button>

      <button (click)="startLoraTraining()" [disabled]="trainingDataCount === 0 || isTraining" class="train-btn">
        <span *ngIf="!isTraining">ğŸ¯ Start LoRA Training</span>
        <span *ngIf="isTraining">â³ Training in Progress...</span>
      </button>

      <button (click)="resetTrainingData()" [disabled]="trainingDataCount === 0" class="reset-training-btn">
        ğŸ—‘ï¸ Clear Training Data ({{ trainingDataCount }} items)
      </button>
    </div>

    <div class="training-info">
      <p><strong>Training Status:</strong> {{
        trainingDataCount === 0 ? 'No training data uploaded yet' :
        trainingDataCount > 0 ? `Ready for training (${trainingDataCount} audio samples)` :
        'Ready'
      }}</p>
      <p><small>Upload multiple audio recordings to create a speech recognition training dataset. Then start LoRA fine-tuning to improve Whisper's accuracy for your voice and use case.</small></p>
    </div>
  </div>

  <!-- Status Display -->
  <div class="status-section">
    <div class="status-card">
      <h4>ğŸ“Š System Status</h4>
      <div class="status-details">
        <div class="status-item">
          <strong>Whisper Model:</strong> {{ whisperStatus }}
        </div>
        <div class="status-item">
          <strong>Language:</strong> {{ getLanguageDisplayName(selectedLanguage) }}
        </div>
        <div class="status-item">
          <strong>Status:</strong> {{ status }}
        </div>
      </div>
    </div>

    <div class="message-display">
      <div *ngIf="lastMessage" class="message" [ngClass]="{'success': lastMessageType === 'success', 'error': lastMessageType === 'error'}">
        {{ lastMessage }}
      </div>
    </div>
  </div>
</div>
